
		# installing python modules
		LDFLAGS+=" -Wl,--as-needed,-lpython${TERMUX_PYTHON_VERSION}"


if [ "$TERMUX_ARCH" = "aarch64" ]; then
		CFLAGS+=" -march=armv8-a"
		export DYNAMIC_LINKER="ld-linux-aarch64.so.1"
elif [ "$TERMUX_ARCH" = "x86_64" ]; then
		CFLAGS+=" -march=x86-64 -fPIC"
		export DYNAMIC_LINKER="ld-linux-x86-64.so.2"
fi
GOARM=8
CGO_ENABLED=1
GO_LDFLAGS="-extldflags=-pie"
RUST_BACKTRACE="full"
CC_x86_64_unknown_linux_gnu="clang"
CFLAGS_x86_64_unknown_linux_gnu="-O3"

local env_host="${CARGO_TARGET_NAME//-/_}"
	export CARGO_TARGET_${env_host@U}_LINKER="${CC}"
	export CARGO_TARGET_${env_host@U}_RUSTFLAGS="-L${TERMUX__PREFIX__LIB_DIR} -C link-arg=-Wl,-rpath=${TERMUX__PREFIX__LIB_DIR} -C link-arg=-Wl,--enable-new-dtags"
	export CFLAGS_${env_host}="${CPPFLAGS} ${CFLAGS}"


	# Remove <sys/capability.h> because it is provided by libcap.
	# Remove <sys/shm.h> from the NDK in favour of that from the libandroid-shmem.
	# Remove <sys/sem.h> as it doesn't work for non-root.
	# Remove <glob.h> as we currently provide it from libandroid-glob.
	# Remove <iconv.h> as it's provided by libiconv.
	# Remove <spawn.h> as it's only for future (later than android-27).
	# Remove <zlib.h> and <zconf.h> as we build our own zlib.
	# Remove unicode headers provided by libicu.
	# Remove KHR/khrplatform.h provided by mesa.
	# Remove EGL, GLES, GLES2, and GLES3 provided by mesa.
	# Remove execinfo provided by libandroid-execinfo.
	# Remove NDK vulkan headers.
	rm usr/include/{sys/{capability,shm,sem},{glob,iconv,spawn,zlib,zconf},KHR/khrplatform,execinfo}.h
	rm usr/include/unicode/{char16ptr,platform,ptypes,putil,stringoptions,ubidi,ubrk,uchar,uconfig,ucpmap,udisplaycontext,uenum,uldnames,ulocdata,uloc,umachine,unorm2,urename,uscript,ustring,utext,utf16,utf8,utf,utf_old,utypes,uvernum,uversion}.h
	rm -Rf usr/include/vulkan
	rm -Rf usr/include/{EGL,GLES{,2,3}}


$TERMUX_ELF_CLEANER --api-level=$TERMUX_PKG_API_LEVEL usr/lib/*/*/*.so | { [[ "${CI-}" == "true" ]] && sed -e '1i\::group::Applying `termux-elf-cleaner`' -e '$a\::endgroup::' || cat; }

for dir in usr/lib/*; do
		# This seem to be needed when building rust
		# packages
		echo 'INPUT(-lunwind)' > $dir/libgcc.a
	done



export DOTNET_CLI_TELEMETRY_OPTOUT=1

	case "${TERMUX_ARCH}" in
	aarch64) DOTNET_TARGET_NAME+="-arm64" ;;
	arm) DOTNET_TARGET_NAME+="-arm" ;;
	i686) DOTNET_TARGET_NAME+="-x86" ;;
	x86_64) DOTNET_TARGET_NAME+="-x64" ;;
	esac


		MESON_CPU_FAMILY="x86_64"
		MESON_CPU="x86_64"

python${TERMUX_PYTHON_VERSION} -m venv --system-site-packages "$_VENV_DIR"
		. "$_VENV_DIR/bin/activate"

		pip install 'setuptools==78.1.0' 'wheel==0.46.1'


git clone --depth 1
git submodule update --init --recursive --depth=1

NODE_OPTIONS="--network-family-autoselection-attempt-timeout=500"





# autotools:
--enable-static --disable-nls --enable-silent-rules --silent --quiet --disable-rpath --disable-rpath-hack --disable-dependency-tracking

MAKE_PROGRAM_PATH=$(command -v ninja)
-DCMAKE_MAKE_PROGRAM=$MAKE_PROGRAM_PATH -DBUILD_TESTING=OFF -DCMAKE_SKIP_INSTALL_RPATH=ON -DCMAKE_USE_SYSTEM_LIBRARIES=True -DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM=NEVER 
	-DCMAKE_FIND_ROOT_PATH_MODE_INCLUDE=ONLY \
		-DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=ONLY \


meson: --buildtype minsize


runs-on: ubuntu-slim
