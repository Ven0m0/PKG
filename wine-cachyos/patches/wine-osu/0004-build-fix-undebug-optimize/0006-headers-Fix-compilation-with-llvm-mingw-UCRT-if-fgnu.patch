From e2be60158032e164952311200154ad54cafa280e Mon Sep 17 00:00:00 2001
From: William Horvath <william@horvath.blog>
Date: Tue, 31 Dec 2024 14:35:39 -0800
Subject: [PATCH] headers: Fix compilation with llvm-mingw UCRT if
 -fgnuc-version>=5.

---
 include/msvcrt/intrin.h                | 4 ++++
 libs/faudio/src/FAudio_internal_simd.c | 4 ++++
 libs/tiff/libtiff/tif_predict.c        | 4 ++++
 3 files changed, 12 insertions(+)

diff --git a/include/msvcrt/intrin.h b/include/msvcrt/intrin.h
index b20fb1b56d0..1c9e816a547 100644
--- a/include/msvcrt/intrin.h
+++ b/include/msvcrt/intrin.h
@@ -8,6 +8,10 @@
 #define _INC_INTRIN
 
 #if defined(__i386__) || (defined(__x86_64__) && !defined(__arm64ec__))
+#if defined(__clang__) && (defined(__MINGW64__) || defined(__MINGW32__))
+#define __mingw_aligned_malloc _aligned_malloc
+#define __mingw_aligned_free _aligned_free
+#endif
 # include <x86intrin.h>
 #endif
 
diff --git a/libs/faudio/src/FAudio_internal_simd.c b/libs/faudio/src/FAudio_internal_simd.c
index 7b7997b2ad0..6c830d9a239 100644
--- a/libs/faudio/src/FAudio_internal_simd.c
+++ b/libs/faudio/src/FAudio_internal_simd.c
@@ -69,6 +69,10 @@
 
 
 #ifdef __SSE2__
+#if defined(__clang__) && (defined(__MINGW64__) || defined(__MINGW32__))
+#define __mingw_aligned_malloc _aligned_malloc
+#define __mingw_aligned_free _aligned_free
+#endif
 #include <emmintrin.h>
 #define HAVE_SSE2_INTRINSICS 1
 #endif
diff --git a/libs/tiff/libtiff/tif_predict.c b/libs/tiff/libtiff/tif_predict.c
index a4512f393b9..afc695c4a21 100644
--- a/libs/tiff/libtiff/tif_predict.c
+++ b/libs/tiff/libtiff/tif_predict.c
@@ -31,6 +31,10 @@
 #include "tiffiop.h"
 
 #if (defined(__x86_64__) || defined(_M_X64)) && !defined(__arm64ec__)
+#if defined(__clang__) && (defined(__MINGW64__) || defined(__MINGW32__))
+#define __mingw_aligned_malloc _aligned_malloc
+#define __mingw_aligned_free _aligned_free
+#endif
 #include <emmintrin.h>
 #endif
 
-- 
2.51.0

