From 8b82d8ecd89252b2f352935cad5186e806d7f71c Mon Sep 17 00:00:00 2001
From: winebuild <wine@build.dev>
Date: Thu, 9 Oct 2025 14:16:04 -0700
Subject: [PATCH] Revert "ntdll: Switch to CLOCK_BOOTTIME for monotonic
 counters when available."

This reverts commit 3d373e452388b60bea9dca6d5c4cf3f8b20a0c54.
---
 dlls/ntdll/unix/sync.c | 4 ++--
 server/request.c       | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/dlls/ntdll/unix/sync.c b/dlls/ntdll/unix/sync.c
index bcd06f8338b..1660478b0e1 100644
--- a/dlls/ntdll/unix/sync.c
+++ b/dlls/ntdll/unix/sync.c
@@ -97,8 +97,8 @@ static inline ULONGLONG monotonic_counter(void)
     return mach_continuous_time() * timebase.numer / timebase.denom / 100;
 #elif defined(HAVE_CLOCK_GETTIME)
     struct timespec ts;
-#ifdef CLOCK_BOOTTIME
-    if (!clock_gettime( CLOCK_BOOTTIME, &ts ))
+#ifdef CLOCK_MONOTONIC_RAW
+    if (!clock_gettime( CLOCK_MONOTONIC_RAW, &ts ))
         return ts.tv_sec * (ULONGLONG)TICKSPERSEC + ts.tv_nsec / 100;
 #endif
     if (!clock_gettime( CLOCK_MONOTONIC, &ts ))
diff --git a/server/request.c b/server/request.c
index 432a5918892..835ea30cec3 100644
--- a/server/request.c
+++ b/server/request.c
@@ -515,8 +515,8 @@ timeout_t monotonic_counter(void)
     return mach_continuous_time() * timebase.numer / timebase.denom / 100;
 #elif defined(HAVE_CLOCK_GETTIME)
     struct timespec ts;
-#ifdef CLOCK_BOOTTIME
-    if (!clock_gettime( CLOCK_BOOTTIME, &ts ))
+#ifdef CLOCK_MONOTONIC_RAW
+    if (!clock_gettime( CLOCK_MONOTONIC_RAW, &ts ))
         return (timeout_t)ts.tv_sec * TICKS_PER_SEC + ts.tv_nsec / 100;
 #endif
     if (!clock_gettime( CLOCK_MONOTONIC, &ts ))
-- 
2.51.0

