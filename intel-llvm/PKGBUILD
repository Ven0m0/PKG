


options=('strip' '!docs' 'zipman' '!debug' 'lto' 'optipng' 'svgo')

git clone https://github.com/intel/llvm.git
cd llvm
mkdir build && cd build

cmake -G Ninja ../llvm \
  -DCMAKE_BUILD_TYPE=Release \
  -DLLVM_TARGETS_TO_BUILD=X86 \
  -DLLVM_TARGET_ARCH=host \
  -DCMAKE_SYSTEM_NAME=Linux \
  -DLVM_DYLIB_COMPONENTS=Native \
  -DLLVM_ENABLE_PROJECTS="polly;lldb;lld;clang-tools-extra;clang;bolt;libclc" \
  -DLLVM_ENABLE_RUNTIMES="libc;libcxxabi;libcxx;compiler-rt;openmp;llvm-libgcc;offload" \
# LLD
  -DLLVM_USE_LINKER=lld \
  -DLLVM_ENABLE_LLD=ON \
  -DBOOTSTRAP_LLVM_ENABLE_LLD=ON \
# Zlib
  -DLLVM_ENABLE_ZLIB=ON \
  -DZLIB_INCLUDE_DIR=/usr/include \
  -DZLIB_LIBRARY=/usr/lib/libz-ng.so \
  #-DZLIB_LIBRARY=$(pkg-config --libs zlib-ng) \
# ZSTD
  -DLLVM_ENABLE_ZSTD=FORCE_ON \
  -DZSTD_LIBRARY=/usr/lib/libzstd.so \
# Libs
  -DLLVM_ENABLE_LIBCXX=ON \
  -DLLVM_ENABLE_LLVM_LIBC=ON \
  -DLLDB_USE_SYSTEM_SIX=1 \
  -DLLVM_ENABLE_CURL=ON" \
  -DLLVM_ENABLE_HTTPLIB=ON \
  -DLLVM_ENABLE_RTTI=ON \
  -DLLVM_BUILD_LLVM_DYLIB=ON \
  -DLLVM_LINK_LLVM_DYLIB=ON \
#Tweaks
  -DCMAKE_CXX_FLAGS_RELEASE="-O3" \
  -DLLVM_UNREACHABLE_OPTIMIZE=ON \
  -DLLVM_ENABLE_THREADS=ON \
  -DLLVM_ENABLE_RPMALLOC=ON \
  -DLLVM_OPTIMIZED_TABLEGEN=ON \
# LTO
  -DLLVM_ENABLE_LTO=Full \
  -DBOOTSTRAP_LLVM_ENABLE_LTO=ON \
# Misc
  #-DLLVM_USE_INTEL_JITEVENTS=ON \
  #-DLLVM_ENABLE_EXPORTED_SYMBOLS_IN_EXECUTABLES=OFF \
  #-DLLVM_ENABLE_DEBUGLOC_COVERAGE_TRACKING=ON \
  #-DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DLLVM_CCACHE_BUILD=ON \
# Bolt
  -DBOLT_ENABLE_RUNTIME_default=ON \
  -DBOLT_ENABLE_RUNTIME=ON \
# Polly
 -DPOLLY_ENABLE_GPGPU_CODEGEN=ON \
# Debloat
  -DLLVM_INCLUDE_TESTS=OFF \
  -DCOMPILER_RT_INCLUDE_TESTS=OFF \
  -DCLANG_INCLUDE_TESTS=OFF \
  -DLLVM_INCLUDE_EXAMPLES=OFF \
  -DLLVM_INCLUDE_BENCHMARKS=OFF \
  -DLLVM_BUILD_DOCS=OFF \
  -DLLVM_INCLUDE_DOCS=OFF \
  -DCLANG_INCLUDE_DOCS=OFF \
  -DLLVM_ENABLE_DOXYGEN=OFF \
  -DLLVM_ENABLE_TELEMETRY=OFF \
  -DBOLT_INCLUDE_DOCS=OFF \
  -DBOLT_INCLUDE_TESTS=OFF \
  -DLLVM_ENABLE_TELEMETRY=OFF \
  -DLLVM_ENABLE_DUMP=OFF \
# Other
-DSPHINX_WARNINGS_AS_ERRORS=OFF \
-DLLVM_USE_PERF=ON \
-DLLVM_LIT_ARGS="-sv --ignore-fail" \
-DLLVM_INSTALL_UTILS=ON

CFLAGS=${CFLAGS/-g /-g1 }
  CXXFLAGS=${CXXFLAGS/-g /-g1 }

ninja -C _build $NINJAFLAGS
