--native_cpu --cuda --use-zstd
-DLLVM_ENABLE_PROJECTS="clang;polly;lld;compiler-rt;openmp

git clone https://github.com/intel/llvm.git
cd llvm
mkdir build && cd build

cmake -G Ninja ../llvm \
  -DCMAKE_BUILD_TYPE=Release \
  -DLLVM_ENABLE_PROJECTS="clang;polly;lld;libcxx;libcxxabi;bolt;compiler-rt;openmp" \
  -DLLVM_ENABLE_LLD=ON \
  -DLLVM_ENABLE_ZLIB=ON \
  -DZLIB_INCLUDE_DIR=/usr/include \
  -DZLIB_LIBRARY=/usr/lib/libz-ng.so \
  -DZLIB_LIBRARY=$(pkg-config --libs zlib-ng) \
  -DLLVM_ENABLE_ZSTD=FORCE_ON \
  -DZSTD_LIBRARY=/usr/lib/libzstd.so \

  -DLLVM_ENABLE_CURL=ON" \
  -DLLVM_ENABLE_HTTPLIB=ON \
  -DLLVM_ENABLE_TELEMETRY=OFF \
  -DLLVM_ENABLE_DUMP=OFF \
  -DLLVM_UNREACHABLE_OPTIMIZE=ON \
  -DLLVM_ENABLE_DEBUGLOC_COVERAGE_TRACKING=ON \
  -DLLVM_USE_LINKER=lld \
  -DLLVM_ENABLE_LLD=ON
  
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
  -DLLVM_ENABLE_RTTI=ON
			--cmake-opt="-DLLVM_ENABLE_PROJECTS="polly;lldb;lld;clang-tools-extra;clang;bolt;libclc" \
			--cmake-opt="-DLLVM_ENABLE_RUNTIMES="libc;libcxxabi;libcxx;compiler-rt;openmp;llvm-libgcc;offload"" \
LLVM_ENABLE_THREADS=ON
-cmake-opt="-D LLDB_USE_SYSTEM_SIX=1"
--cmake-opt="-DLLVM_ENABLE_CURL=ON"


LLVM_ENABLE_LIBCXX=ON
LLVM_ENABLE_LLVM_LIBC=ON
LLVM_ENABLE_LLD=ON
LLVM_USE_LINKER=lld
BOOTSTRAP_LLVM_ENABLE_LLD=ON
LLVM_ENABLE_LTO=ON
BOOTSTRAP_LLVM_ENABLE_LTO=ON
LLVM_USE_INTEL_JITEVENTS=ON
LLVM_ENABLE_EXPORTED_SYMBOLS_IN_EXECUTABLES=OFF
LLVM_ENABLE_RPMALLOC=ON
LVM_DYLIB_COMPONENTS=Native
-DCMAKE_BUILD_TYPE=Release
--cmake-opt="-DLLVM_TARGETS_TO_BUILD=X86"
LLVM_TARGET_ARCH=host
CMAKE_SYSTEM_NAME=Linux
CMAKE_CXX_FLAGS_RELEASE="-O3

BOLT_ENABLE_RUNTIME_default=ON
BOLT_ENABLE_RUNTIME=ON
BOLT_INCLUDE_DOCS=OFF
BOLT_INCLUDE_TESTS=OFF

LLVM_CCACHE_BUILD=ON
LLVM_ENABLE_THREAD=ON
LLVM_INCLUDE_TESTS=OFF
COMPILER_RT_INCLUDE_TESTS=OFF
CLANG_INCLUDE_TESTS=OFF
LLVM_INCLUDE_EXAMPLES=OFF
LLVM_INCLUDE_BENCHMARKS=OFF
LLVM_BUILD_DOCS=OFF
LLVM_INCLUDE_DOCS=OFF
CLANG_INCLUDE_DOCS=OFF
LLVM_ENABLE_DOXYGEN=OFF
LLVM_ENABLE_TELEMETRY=OFF


--cmake-opt="-DLLVM_ENABLE_RPMALLOC=ON"
--cmake-opt="-DCMAKE_BUILD_TYPE=Release"

--cmake-opt="LLVM_OPTIMIZED_TABLEGEN=ON
--cmake-opt="LLVM_ENABLE_RUNTIMES=all --cmake-opt="-D LLVM_ENABLE_PROJECTS="polly;lldb;lld;compiler-rt;clang-tools-extra;clang;bolt;libc;libclc;openmp" --cmake-opt="LLVM_ENABLE_LTO=Full


--cmake-opt="-DLLVM_ENABLE_PROJECTS=clang;libcxx;libcxxabi;bolt;compiler-rt;openmp;polly;lld" \
--cmake-opt="-DLLVM_ENABLE_TELEMETRY=OFF"
--cmake-opt="-DLLVM_UNREACHABLE_OPTIMIZE=ON"
--cmake-opt="-DLLVM_ENABLE_ZSTD=FORCE_ON"
--cmake-opt="-DZSTD_LIBRARY=/usr/lib/libzstd.so" \
--cmake-opt="-DLLVM_ENABLE_LLD=ON" \
--cmake-opt="-DLLVM_USE_LINKER=lld" \
--cmake-opt="-DZLIB_INCLUDE_DIR=/usr/include" \
--cmake-opt="-DZLIB_LIBRARY=$(pkg-config --libs zlib-ng)" \
--cmake-opt="-DLLVM_ENABLE_DEBUGLOC_COVERAGE_TRACKING=ON"
--cmake-opt="-DLLVM_ENABLE_ZLIB=ON"

--cmake-opt="POLLY_ENABLE_GPGPU_CODEGEN=ON"


CFLAGS=${CFLAGS/-g /-g1 }
  CXXFLAGS=${CXXFLAGS/-g /-g1 }


rm cmake/modules/Findzstd.cmake
build() {
    export CFLAGS+=" ${CPPFLAGS}"
    export CXXFLAGS+=" ${CPPFLAGS}"
    cmake \
        -B _build \
        -S "$srcdir"/llvm-project/llvm  \
        -G Ninja \
        -D CMAKE_BUILD_TYPE=Release \
        -D CMAKE_INSTALL_PREFIX=/usr \
        -D LLVM_BINUTILS_INCDIR=/usr/include \
        -D LLVM_APPEND_VC_REV=ON \
        -D LLVM_VERSION_SUFFIX="" \
        -D LLVM_HOST_TRIPLE=$CHOST \
        --cmake-opt="-D LLVM_ENABLE_RTTI=ON" \
        --cmake-opt="-D LLVM_ENABLE_FFI=ON" \
        --cmake-opt="-D FFI_INCLUDE_DIR:PATH="$(pkg-config --variable=includedir libffi)" \
        --cmake-opt="-D LLVM_BUILD_LLVM_DYLIB=ON" \
        --cmake-opt="-D LLVM_LINK_LLVM_DYLIB=ON" \
        --cmake-opt="-D LLVM_INSTALL_UTILS=ON" \
        -DLLVM_ENABLE_CURL=ON
        -D LLVM_BUILD_DOCS=ON \
        -D LLVM_ENABLE_DOXYGEN=OFF \
        -D LLVM_ENABLE_SPHINX=ON \
        -D LLVM_ENABLE_BINDINGS=OFF \
        -D SPHINX_OUTPUT_HTML:BOOL=OFF \
        -D SPHINX_WARNINGS_AS_ERRORS=OFF \
        -D POLLY_ENABLE_GPGPU_CODEGEN=ON \
        --cmake-opt="-D LLDB_USE_SYSTEM_SIX=1" \
        --cmake-opt="-D LLVM_ENABLE_PROJECTS="polly;lldb;lld;compiler-rt;clang-tools-extra;clang;bolt;libc;libclc;openmp" \
        -D LLVM_LIT_ARGS="-sv --ignore-fail" \
        -D LLVM_ENABLE_DUMP=ON \
        -D LLVM_ENABLE_LLD=ON \
        -D LLVM_USE_LINKER=lld \
        -D LLVM_ENABLE_ZSTD=ON
        -D ZSTD_LIBRARY=/usr/lib/libzstd.so
        -D ZLIB_INCLUDE_DIR=/usr/include
        -D ZLIB_LIBRARY=$(pkg-config --libs zlib-ng
        -D LLVM_UNREACHABLE_OPTIMIZE=ON
        -D LLVM_ENABLE_TELEMETRY=OFF
        -DLLVM_USE_PERF=ON
        -Wno-dev

    ninja -C _build $NINJAFLAGS
}
